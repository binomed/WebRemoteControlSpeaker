<script>

	const SocketMixin = subclass => class extends ModelMixin(subclass) {

		static get config() {
			// properties, observers meta data
			return {
				properties: {
					socketIO: Object
				}
			};
		}

		connectedCallback() {
			super.connectedCallback();
			console.log(this.conf);
			if ( typeof io != 'undefined'){
				this.socketIO = io.connect('http://'+window.location.hostname+':'+this.conf.port);

				// Socket IO connect
				this.socketIO.on('connect',_ => {
					// Send a ping message for getting config
					this.socketIO.emit('message', {
						type:'ping'
					});


					// Ask for plugins
					this.socketIO.emit('message', {
						type:'ping-plugin'
					});

				});


				// Message from presentation
				this.socketIO.on("message", this._presentationMessage.bind(this));
			}
		}


		_presentationMessage(json){
			// To overide
			switch (json.type){
				case 'config':
					if (json.url){
						this.localUrl = "http://"+window.location.hostname+":"+this.conf.port+json.url;
						this.nbSlides = json.nbSlides;
						this.mapPosition = json.mapPosition;						
					}else if(json.indices){
						this.indicesDist = json.indices;
	                    this.currentSlideNumber = this.mapPosition[this.indicesDist.h+'-'+this.indicesDist.v];
					}
				break;
				case 'notes':
					console.log(json.data.notes);
					//if( json.data.markdown ) {
					//	this.contentNotes = marked( json.data.notes );
					//}
					//else {
						this.contentNotes =  json.data.notes;
					//}                         
				break;
				case 'plugin':
				break;
			}
		}

	};

</script>
