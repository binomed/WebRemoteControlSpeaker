<link rel="import" href="dispatcher-mixin.html">

<script>
	const PluginMixin = subclass => class extends DispatcherMixin(subclass) {

		constructor() {
			super();
			this.currentPlugin = null;
			this.interactionAreaRect = null;
		}

		static get properties() {
			// properties, observers meta data
			return {
					activPlugin: {
						type: Object,
						value: () => { return null; },
						observer: '_changeActivPlugin'
					},
					descArea: {
						type: Object,
						value: () => { return null; },
						observer: '_updateAreas'
					},
					interactionArea: {
						type: Object,
						value: () => { return null; },
						observer: '_updateAreas'
					}
				};
		}

		connectedCallback() {
			super.connectedCallback();
			this.currentPlugin = this.getPlugin();
		}

		registerPlugin() {
			if (this.currentPlugin) {
				this.currentPlugin.activ = true;
				this.dispatchAction('register-plugin', this.currentPlugin);
			}
		}

		_updateAreas(area) {
			if (this.descArea && this.$.descArea) {
				this._applyStyle(this.$.descArea, this.descArea);
			}

			if (this.interactionArea && this.$.interactionArea) {
				this.interactionAreaRect = this._applyStyle(this.$.interactionArea, this.interactionArea);
			}
		}

		_applyStyle(element, srcElement) {
			const srcElementRect = srcElement.getBoundingClientRect();
			const srcElementStyle = window.getComputedStyle(srcElement);
			element.style['margin-top'] = srcElementStyle.marginTop;
			element.style['margin-bottom'] = srcElementStyle.marginBottom;
			element.style.width = (srcElementRect.right - srcElementRect.left) + 'px';
			element.style.height = `calc(${srcElementRect.bottom}px - ${srcElementRect.top}px)`;
			element.style.top = `calc(${srcElementRect.top}px - ${srcElementStyle.marginTop})`;
			element.style.left = srcElementRect.left + 'px';
			return srcElementRect;
		}

		_changeActivPlugin(plugin) {
			if (this.$.parent) {
				this.$.parent.style.display = 'none';
				if (plugin) {
					if (this.currentPlugin && this.currentPlugin.id === plugin.id) {
						this.$.parent.style.display = '';
						this._updateAreas();
					}
				}
			}
		}

		desactivPlugin() {
			this.dispatchAction('desactiv-plugin', {});
		}

		getPlugin() {
			return null;
		}

	};

</script>
