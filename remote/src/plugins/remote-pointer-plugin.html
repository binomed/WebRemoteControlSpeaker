<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/font-roboto/roboto.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../mixins/helpers/plugin-mixin.html">

<dom-module id="remote-pointer-plugin">
	<template>

		<!-- Styles MUST be inside template -->
		<style>

		:host {
			display: block;
			position: relative;
			overflow: hidden;
			--size-button:40px;
		}

		.sws-plugin-rp-desc {
			padding : 10px;
			overflow : auto;
			font-size : 1.2em;
			height : calc(100% - var(--size-button) - 15px);
		}

		.sws-plugin-rp-box.color {
			box-shadow : 0px 0px 10px 0 black;
			width: var(--size-button);
			height: var(--size-button);
			border-radius : var(--size-button);
			border : solid 1px white;
			bottom : 20px;
			top : initial;
			position: relative;
		}

		.sws-plugin-rp-box.color.activ::after {
			content : '';
			position : absolute;
			top : calc(var(--size-button) + 5px);
			left : 5px;
			width : calc(var(--size-button) - 10px);
			height : 5px;
			box-shadow : 0px 0px 10px 0 black;
		}

		.sws-plugin-rp-box.color.red::after, .sws-plugin-rp-box.color.red {
			background-color : #FF0000;
		}

		.sws-plugin-rp-box.color.white::after, .sws-plugin-rp-box.color.white {
			background-color : #FFFFFF;
		}

		.sws-plugin-rp-box.color.black::after, .sws-plugin-rp-box.color.black {
			background-color : #000000;
		}

		.sws-plugin-rp-box.color.blue::after, .sws-plugin-rp-box.color.blue {
			background-color : #005FFF;
		}

		#parent{
			position: relative;
			width: 100%;
			height: 100%;
		}

		#descArea{
			position:absolute;
			background: white;
		}

		#interactionArea{
			position:absolute;
			--border-color: red;
			border-color: var(--border-color);
			border-style: solid;
			border-width: 5px;
		}

		app-toolbar {
			background-color: var(--bg-color);
		}

		app-toolbar > paper-icon-button{
			background-color: var(--bg-color-abs);
			color: #fff;
		}

		.button-parent{
			display: inline-flex;
			height: calc(2* var(--size-button));
			position: absolute;
			left: 0;
			bottom: 0;
			width: 100%;
			justify-content: space-around;
		}

	</style>

<div id="parent">
	<div id="descArea">
		<app-toolbar>
			<div main-title>Pointer Sensor</div>
			<paper-icon-button icon="close" on-tap="desactivPlugin"></paper-icon-button>
		</app-toolbar>
		<div class="sws-plugin-rp-desc">
			<ol>
				<li>Choose the color pointer</li>
				<li>Drag your finger on the preview area to show the pointer</li>
			</ol>
		</div>
		<div class="button-parent">
			<div id="red" class="sws-plugin-rp-box color red" on-tap="_chooseColor" on-click="_chooseColor"></div>
			<div id="white" class="sws-plugin-rp-box color white" on-tap="_chooseColor" on-click="_chooseColor"></div>
			<div id="black" class="sws-plugin-rp-box color black" on-tap="_chooseColor" on-click="_chooseColor"></div>
			<div id="blue" class="sws-plugin-rp-box color blue" on-tap="_chooseColor" on-click="_chooseColor"></div>
		</div>
	</div>
	<div id="interactionArea"
			on-touchstart="_touchMove"
			on-touchmove="_touchMove"
			on-touchend="_touchEnd">
	</div>
</div>


</template>

	<script>
		// Extend Polymer.Element base class
		class RemotePointerPlugin extends PluginMixin(Polymer.Element) {

			static get is() { return 'remote-pointer-plugin' }

			constructor() {
				super();
				this.currentColor = 'red';
			}

			connectedCallback() {
				super.connectedCallback();
				this._processColor('red');
			}

			getPlugin() {
				return {
					name: 'remote pointer',
					icon: 'icons:create',
					id: 'rp'
				}
			}

			_chooseColor(event) {
				this._processColor(event.currentTarget.id);
			}

			_processColor(color) {
				this.currentColor = color;

				this.$.red.classList.remove('activ');
				this.$.white.classList.remove('activ');
				this.$.black.classList.remove('activ');
				this.$.blue.classList.remove('activ');
				this.$[color].classList.add('activ');
				this.$.interactionArea.style.setProperty('border-color', color);

			}

			_touchMove(event) {
				if (event.touches && event.touches.length > 0) {
					const touch = event.touches[0];
					const x = touch.clientX,
						y = touch.clientY;

					const percentX = ((x - this.interactionAreaRect.left) / this.interactionAreaRect.width) * 100;
					const percentY = ((y - this.interactionAreaRect.top) / this.interactionAreaRect.height) * 100;
					this.dispatchAction('plugin-communication', {
						plugin: 'rp',
						data: {
							hide: false,
							x: Math.round(percentX),
							y: Math.round(percentY),
							color: this.currentColor
						}
					});
				}
			}

			_touchEnd(event) {
				this.dispatchAction('plugin-communication', {
					plugin: 'rp',
					data: {
						hide: true
					}
				});
			}

		}

		// Register custom element definition using standard platform API
		customElements.define(RemotePointerPlugin.is, RemotePointerPlugin);

	</script>
</dom-module>
